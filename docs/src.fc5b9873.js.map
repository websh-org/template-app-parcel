{"version":3,"sources":["../node_modules/@websh/remote-slave-port/remote-slave-port.mjs","../node_modules/@websh/web-shell-app/web-shell-app.mjs","manifest.json","index.js"],"names":["RemoteSlavePort","constructor","id","_port","_manifest","_commands","_handlers","_receive","cmd","args","rsvp","throw","res","result","transfer","concat","postMessage","re","error","message","String","data","_connect","ev","source","window","parent","port","manifest","removeEventListener","onmessage","addEventListener","m","on","fn","push","command","trigger","event","WebShellApp","module","exports","v","name","icon","description","version","license","homepage","repository","api","file","new","open","save","formats","text","type","extension","accept","encoding","modelist","ace","require","console","log","format","content","mode","getModeForPath","editor","session","setMode","setValue","getValue","edit","setTheme"],"mappings":"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","file":"src.fc5b9873.js","sourceRoot":"../src","sourcesContent":["export class RemoteSlavePort {\n  constructor(id) {\n    this._port = null;\n    this._manifest = {};\n    this._commands = {};\n    this._handlers = {};\n\n    const _receive = async ({ cmd, args, rsvp }) => {\n      try {\n        if (!cmd) {\n          this.throw(\"slave-specify-command\");\n        }\n        if (!this._commands[cmd]) {\n          this.throw(\"slave-no-such-command\");\n        }\n        const res = await this._commands[cmd](args);\n        const [result, transfer] = [].concat(res);\n        this._port.postMessage({ result, re: rsvp }, transfer)\n      } catch (error) {\n        this._port.postMessage({ error: error.error| error.message || String(error), data:error.data || {}, re: rsvp })\n      }\n    }\n\n    const _trigger = async (ev, data) => {\n      for (var h in this._handlers[ev]) {\n        this._handlers[ev][h](data);\n      }\n    }\n\n    const _connect = (ev) => {\n      if (ev.source !== window.parent) return;\n      if (!ev.data || !ev.data.port || !ev.data[id] === 'connect') return;\n      this._port = ev.data.port;\n      this._port.postMessage({ [id]: 'connected', manifest: this._manifest })\n      window.removeEventListener('message', _connect);\n      this._port.onmessage = ev => {\n        _receive(ev.data);\n      }\n    }\n\n    window.addEventListener('message', _connect);\n  }\n\n  manifest(m) {\n    this._manifest = m;\n    return this;\n  }\n\n  on(ev, fn) {\n    this._handlers[ev] = this._handlers[ev] || [];\n    this._handlers[ev].push(fn);\n    return this;\n  }\n\n  command(cmd, fn) {\n    this._commands[cmd] = fn;\n    return this;\n  }\n\n  trigger(event, data = {}) {\n    port.postMessage({ event, data });\n    return this;\n  }\n\n  throw(error, data = {}) {\n    throw { error, data }\n  }\n}\n","import { RemoteSlavePort } from \"@websh/remote-slave-port\";\nexport const WebShellApp = new RemoteSlavePort('SOUTH-TOOTH');\nWebShellApp.command('proc-close',()=>true);","module.exports={v:0,name:\"ACE\",icon:\"icon.svg\",description:\"Ace Code Editor for WebShell\",version:\"1.4.6\",license:\"MIT\",homepage:\"https://github.com/websh-org/app-ace#readme\",repository:\"https://github.com/websh-org/app-ace.git\",api:{file:{new:\"text\",open:[\"text\"],save:[\"text\"],formats:{text:{type:\"text/plain\",name:\"Text File\",extension:\"txt\",accept:\"text/*,application/json\",encoding:\"text\"}}}}};","import { WebShellApp } from \"@websh/web-shell-app\";\nimport manifest from \"./manifest.json\";\nWebShellApp.manifest(manifest);\n\nvar modelist = ace.require(\"ace/ext/modelist\");\nconsole.log({modelist})\n\nWebShellApp.command('file-open',({format,content,extension})=>{\n  var mode = modelist.getModeForPath(\"file.\"+extension);\n  editor.session.setMode(mode.mode);\n  editor.setValue(content);\n})\n\nWebShellApp.command('file-save',()=>{\n  return {content:editor.getValue(),type:\"text/plain\"};\n})\n\nWebShellApp.command('file-new',()=>{\n  editor.setValue(\"\")\n})\n\nvar editor = ace.edit(\"editor\");\neditor.setTheme(\"ace/theme/monokai\");"]}